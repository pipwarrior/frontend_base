{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yapfengwei/Desktop/MyApplications/catalogProject_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yapfengwei/Desktop/MyApplications/catalogProject_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/yapfengwei/Desktop/MyApplications/catalogProject_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{BrowserRouter as Router}from'react-router-dom';import axios from'axios';import UserContext from'./context/UserContext.js';import Routes from'./Routes';import Header from'./Components/Layout/Header';import'./App.css';var App=function App(){var _useState=useState({token:undefined,user:undefined}),_useState2=_slicedToArray(_useState,2),userData=_useState2[0],setUserData=_useState2[1];useEffect(function(){var checkLoggedIn=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var token,tokenRes,userRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:token=localStorage.getItem('auth-token');if(token===null){localStorage.setItem('auth-token','');localStorage.setItem('accountType','');token='';}// Use this to check token timer\n_context.next=4;return axios.post(process.env.REACT_APP_API+'/api/auth/tokenIsValid',null,{headers:{'auth-token':token}});case 4:tokenRes=_context.sent;if(!tokenRes.data){_context.next=10;break;}_context.next=8;return axios.get(process.env.REACT_APP_API+'/api/users',{headers:{'auth-token':token}});case 8:userRes=_context.sent;setUserData({token:token,accountType:userRes.data.accountType,username:userRes.data.username,fullName:userRes.data.fullName});case 10:case\"end\":return _context.stop();}}},_callee);}));return function checkLoggedIn(){return _ref.apply(this,arguments);};}();checkLoggedIn();},[]);return/*#__PURE__*/React.createElement(Router,null,/*#__PURE__*/React.createElement(UserContext.Provider,{value:{userData:userData,setUserData:setUserData}},/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(Routes,null)));};export default App;","map":{"version":3,"sources":["/Users/yapfengwei/Desktop/MyApplications/catalogProject_frontend/src/App.js"],"names":["React","useEffect","useState","BrowserRouter","Router","axios","UserContext","Routes","Header","App","token","undefined","user","userData","setUserData","checkLoggedIn","localStorage","getItem","setItem","post","process","env","REACT_APP_API","headers","tokenRes","data","get","userRes","accountType","username","fullName"],"mappings":"kiBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,aAAa,GAAIC,CAAAA,MAA1B,KAAwC,kBAAxC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,WAAP,KAAwB,0BAAxB,CAEA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,4BAAnB,CAEA,MAAO,WAAP,CAEA,GAAMC,CAAAA,GAAG,CAAG,QAANA,CAAAA,GAAM,EAAM,eACgBP,QAAQ,CAAC,CACvCQ,KAAK,CAAEC,SADgC,CAEvCC,IAAI,CAAED,SAFiC,CAAD,CADxB,wCACTE,QADS,eACCC,WADD,eAMhBb,SAAS,CAAC,UAAM,CACd,GAAMc,CAAAA,aAAa,0FAAG,8JAChBL,KADgB,CACRM,YAAY,CAACC,OAAb,CAAqB,YAArB,CADQ,CAEpB,GAAGP,KAAK,GAAK,IAAb,CAAmB,CACjBM,YAAY,CAACE,OAAb,CAAqB,YAArB,CAAkC,EAAlC,EACAF,YAAY,CAACE,OAAb,CAAqB,aAArB,CAAmC,EAAnC,EACAR,KAAK,CAAC,EAAN,CACD,CAED;AARoB,sBASGL,CAAAA,KAAK,CAACc,IAAN,CACrBC,OAAO,CAACC,GAAR,CAAYC,aAAZ,CAA0B,wBADL,CAErB,IAFqB,CAGrB,CAACC,OAAO,CAAE,CAAC,aAAcb,KAAf,CAAV,CAHqB,CATH,QASdc,QATc,mBAejBA,QAAQ,CAACC,IAfQ,gDAgBIpB,CAAAA,KAAK,CAACqB,GAAN,CAAUN,OAAO,CAACC,GAAR,CAAYC,aAAZ,CAA0B,YAApC,CAAkD,CAACC,OAAO,CAAE,CAAC,aAAcb,KAAf,CAAV,CAAlD,CAhBJ,QAgBZiB,OAhBY,eAiBlBb,WAAW,CAAC,CACVJ,KAAK,CAAEA,KADG,CAEVkB,WAAW,CAAED,OAAO,CAACF,IAAR,CAAaG,WAFhB,CAGVC,QAAQ,CAAEF,OAAO,CAACF,IAAR,CAAaI,QAHb,CAIVC,QAAQ,CAAEH,OAAO,CAACF,IAAR,CAAaK,QAJb,CAAD,CAAX,CAjBkB,uDAAH,kBAAbf,CAAAA,aAAa,0CAAnB,CAyBAA,aAAa,GACd,CA3BQ,CA2BN,EA3BM,CAAT,CA6BA,mBACE,oBAAC,MAAD,mBACE,oBAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE,CAAEF,QAAQ,CAARA,QAAF,CAAYC,WAAW,CAAXA,WAAZ,CAA7B,eACE,oBAAC,MAAD,MADF,cAEE,oBAAC,MAAD,MAFF,CADF,CADF,CAQD,CA3CD,CA6CA,cAAeL,CAAAA,GAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { BrowserRouter as Router } from 'react-router-dom';\nimport axios from 'axios';\nimport UserContext from './context/UserContext.js';\n\nimport Routes from './Routes';\nimport Header from './Components/Layout/Header';\n\nimport './App.css';\n\nconst App = () => {\n  const [userData, setUserData] = useState({\n    token: undefined,\n    user: undefined,\n  })\n  \n  useEffect(() => {\n    const checkLoggedIn = async () => {\n      let token = localStorage.getItem('auth-token');\n      if(token === null) {\n        localStorage.setItem('auth-token','');\n        localStorage.setItem('accountType','')\n        token='';\n      }\n\n      // Use this to check token timer\n      const tokenRes = await axios.post(\n        process.env.REACT_APP_API+'/api/auth/tokenIsValid',\n        null,\n        {headers: {'auth-token': token}}\n      )\n\n      if(tokenRes.data){\n        const userRes = await axios.get(process.env.REACT_APP_API+'/api/users', {headers: {'auth-token': token}});\n        setUserData({\n          token: token,\n          accountType: userRes.data.accountType,\n          username: userRes.data.username,\n          fullName: userRes.data.fullName\n        })\n      }\n    }\n    checkLoggedIn();\n  }, [])\n  \n  return (\n    <Router>\n      <UserContext.Provider value={{ userData, setUserData }}>\n        <Header />\n        <Routes />\n      </UserContext.Provider>\n    </Router>\n  )\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}